

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Feature Engineering Guide &mdash; ballet 0.19.3 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Consumer Guide" href="consumer_guide.html" />
    <link rel="prev" title="Contributor Guide" href="contributor_guide.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> ballet
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="readme.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="readme.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="readme.html#next-steps">Next steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="readme.html#source-code-organization">Source code organization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#stable-release">Stable release</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#from-source">From source</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">User Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="maintainer_guide.html">Maintainer Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="maintainer_guide.html#creating-a-ballet-project">Creating a Ballet project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#project-instantiation">Project instantiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#project-installation">Project installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#collaboration-via-git-and-github">Collaboration via git and GitHub</a><ul>
<li class="toctree-l4"><a class="reference internal" href="maintainer_guide.html#automatic-repository-creation">Automatic repository creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="maintainer_guide.html#manual-repository-creation">Manual repository creation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#enabling-continuous-integration">Enabling continuous integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#installing-bots">Installing bots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="maintainer_guide.html#configuring-the-project">Configuring the project</a></li>
<li class="toctree-l2"><a class="reference internal" href="maintainer_guide.html#developing-new-features">Developing new features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#validating-features">Validating features</a></li>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#pruning-features">Pruning features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="maintainer_guide.html#updating-the-framework">Updating the framework</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributor_guide.html">Contributor Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributor_guide.html#cloud-feature-development-workflow">Cloud Feature Development Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="contributor_guide.html#launch-assemble">Launch Assemblé</a></li>
<li class="toctree-l3"><a class="reference internal" href="contributor_guide.html#work-in-a-notebook">Work in a notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="contributor_guide.html#authenticate-with-github">Authenticate with GitHub</a></li>
<li class="toctree-l3"><a class="reference internal" href="contributor_guide.html#develop-a-new-feature">Develop a new feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="contributor_guide.html#test-your-feature">Test your feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="contributor_guide.html#submit-your-feature">Submit your feature</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="contributor_guide.html#local-feature-development-workflow">Local Feature Development Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="contributor_guide.html#setup-your-development-environment">Setup your development environment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="contributor_guide.html#fork-the-project">Fork the project</a></li>
<li class="toctree-l4"><a class="reference internal" href="contributor_guide.html#clone-your-fork">Clone your fork</a></li>
<li class="toctree-l4"><a class="reference internal" href="contributor_guide.html#create-a-virtualenv">Create a virtualenv</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="contributor_guide.html#contributor-guide-develop-a-new-feature-local">Develop a new feature</a><ul>
<li class="toctree-l4"><a class="reference internal" href="contributor_guide.html#update-and-install-the-project">Update and install the project</a></li>
<li class="toctree-l4"><a class="reference internal" href="contributor_guide.html#start-working-on-a-new-feature">Start working on a new feature</a></li>
<li class="toctree-l4"><a class="reference internal" href="contributor_guide.html#write-your-feature">Write your feature</a></li>
<li class="toctree-l4"><a class="reference internal" href="contributor_guide.html#contributor-guide-test-your-feature-local">Test your feature</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="contributor_guide.html#submit-the-feature">Submit the feature</a><ul>
<li class="toctree-l4"><a class="reference internal" href="contributor_guide.html#option-1-git-workflow">Option 1: Git workflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="contributor_guide.html#option-2-in-lab-workflow">Option 2: In-Lab Workflow</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="contributor_guide.html#understanding-validation-results">Understanding Validation Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributor_guide.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Feature Engineering Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#feature-engineering-in-90-seconds">Feature engineering in 90 seconds</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-features">Writing features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#feature-definitions">Feature definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#input-types">Input types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transformers">Transformers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automatic-data-conversions">Automatic data conversions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#feature-engineering-pipelines">Feature engineering pipelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#okay-but-why">Okay, but why?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#learn-by-example">Learn by example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-simple-feature">A simple feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="#learned-transformations">Learned transformations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multi-column-inputs-and-transformer-lists">Multi-column inputs and transformer lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nested-transformers">Nested transformers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#complex-features">Complex features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#feature-engineering-primitives">Feature engineering primitives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#operating-on-groups">Operating on groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logic-to-avoid-leakage">Logic to avoid leakage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-cleaning">Data cleaning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operating-on-time-series-data">Operating on time series data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utilities">Utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-primitives">Other primitives</a></li>
<li class="toctree-l3"><a class="reference internal" href="#external-libraries">External libraries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#differences-from-pandas">Differences from Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rolling-your-own-transformers">Rolling your own transformers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#further-reading">Further reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="consumer_guide.html">Consumer Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="consumer_guide.html#install-a-project">Install a project</a></li>
<li class="toctree-l2"><a class="reference internal" href="consumer_guide.html#engineer-features">Engineer features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="consumer_guide.html#using-the-command-line">Using the command line</a></li>
<li class="toctree-l3"><a class="reference internal" href="consumer_guide.html#using-the-library">Using the library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="consumer_guide.html#build-an-ml-pipeline">Build an ML pipeline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="consumer_guide.html#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="consumer_guide.html#ml-pipeline-usage">ML pipeline usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="consumer_guide.html#ballet-project-detection">Ballet project detection</a></li>
<li class="toctree-l3"><a class="reference internal" href="consumer_guide.html#primitive-and-pipeline-discovery">Primitive and pipeline discovery</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#general">General</a><ul>
<li class="toctree-l3"><a class="reference internal" href="faq.html#how-can-i-check-the-performance-of-a-feature">How can I check the performance of a feature?</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html#there-was-an-error-submitting-my-feature-using-assemble-in-jupyter-lab">There was an error submitting my feature using Assemblé in Jupyter Lab.</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html#my-feature-has-a-valid-api-locally-why-was-it-rejected">My feature has a valid API locally, why was it rejected?</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html#why-did-my-feature-fail-the-feature-acceptance-validation">Why did my feature fail the feature acceptance validation?</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html#are-there-any-differences-between-local-validation-and-ci-validation">Are there any differences between local validation and CI validation?</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html#my-feature-relies-on-a-new-library-how-can-i-add-it-to-the-project">My feature relies on a new library, how can I add it to the project?</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html#how-do-i-delete-an-already-accepted-feature">How do I delete an already-accepted feature?</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html#how-do-i-edit-a-feature-definition-that-has-been-rejected">How do I edit a feature definition that has been rejected?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#developing-features">Developing features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="faq.html#how-can-i-learn-to-write-better-features">How can I learn to write better features?</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html#how-do-i-debug-a-failing-cantransformonerowcheck">How do I debug a failing <code class="docutils literal notranslate"><span class="pre">CanTransformOneRowCheck</span></code>?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/ballet.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/ballet.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.eng.html">ballet.eng package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/ballet.eng.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/ballet.eng.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.mlprimitives.html">ballet.mlprimitives package</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.util.html">ballet.util package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/ballet.util.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.validation.html">ballet.validation package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/ballet.validation.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/ballet.validation.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/ballet.html#submodules">Submodules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.cli.html">ballet.cli module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.client.html">ballet.client module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.compat.html">ballet.compat module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.contrib.html">ballet.contrib module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.discovery.html">ballet.discovery module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.encoder.html">ballet.encoder module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.exc.html">ballet.exc module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.feature.html">ballet.feature module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.pipeline.html">ballet.pipeline module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.project.html">ballet.project module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.templating.html">ballet.templating module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.transformer.html">ballet.transformer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.update.html">ballet.update module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html">CLI Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cli_reference.html#ballet-quickstart">quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli_reference.html#ballet-start-new-feature">start-new-feature</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli_reference.html#ballet-update-project-template">update-project-template</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli_reference.html#ballet-validate">validate</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mlp_reference.html">MLPrimitives/MLPipelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mlp_reference.html#primitives">primitives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mlp_reference.html#ballet-engineer-features">ballet.engineer_features</a></li>
<li class="toctree-l3"><a class="reference internal" href="mlp_reference.html#ballet-encode-target">ballet.encode_target</a></li>
<li class="toctree-l3"><a class="reference internal" href="mlp_reference.html#ballet-drop-missing-targets">ballet.drop_missing_targets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mlp_reference.html#pipelines">pipelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mlp_reference.html#ballet-rf-classifier">ballet_rf_classifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="mlp_reference.html#ballet-rf-regressor">ballet_rf_regressor</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Development Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#types-of-contributions">Types of Contributions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="contributing.html#report-bugs">Report Bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="contributing.html#fix-bugs">Fix Bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="contributing.html#implement-features">Implement Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="contributing.html#write-documentation">Write Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="contributing.html#submit-feedback">Submit Feedback</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#get-started">Get Started!</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#pull-request-guidelines">Pull Request Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#tips">Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#deploying">Deploying</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Credits</a><ul>
<li class="toctree-l2"><a class="reference internal" href="authors.html#development-lead">Development Lead</a></li>
<li class="toctree-l2"><a class="reference internal" href="authors.html#contributors">Contributors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a><ul>
<li class="toctree-l2"><a class="reference internal" href="history.html#id1">0.19.3 (2021-06-28)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id3">0.19.2 (2021-06-21)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id4">0.19.1 (2021-06-20)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id5">0.19.0 (2021-06-16)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id7">0.18.0 (2021-06-06)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id9">0.17.0 (2021-05-24)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id11">0.16.0 (2021-05-22)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id13">0.15.2 (2021-05-14)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id14">0.15.1 (2021-05-12)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id15">0.15.0 (2021-05-12)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id17">0.14.0 (2021-05-11)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id21">0.13.1 (2021-04-02)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id22">0.13.0 (2021-03-30)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id23">0.12.0 (2021-03-10)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id24">0.11.0 (2021-03-04)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id25">0.10.0 (2021-02-23)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id26">0.9.0 (2021-02-16)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id27">0.8.2 (2021-02-16)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id28">0.8.1 (2021-02-16)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id29">0.8.0 (2021-02-02)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id30">0.7.11 (2020-09-16)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id31">0.7.10 (2020-09-08)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id32">0.7.9 (2020-08-15)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id33">0.7.8 (2020-08-13)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id34">0.7.7 (2020-08-12)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id35">0.7.6 (2020-08-12)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id36">0.7.5 (2020-08-03)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id37">0.7.4 (2020-07-22)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id38">0.7.3 (2020-07-21)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id39">0.7.2 (2020-07-21)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id40">0.7.1 (2020-07-20)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id41">0.7 (2020-07-17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id42">0.6 (2019-11-12)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id43">0.5 (2018-10-14)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id44">0.4 (2018-09-21)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id45">0.3 (2018-04-28)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id46">0.2 (2018-04-11)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id47">0.1 (2018-04-08)</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ballet</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Feature Engineering Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/ballet/ballet/blob/master/docs/feature_engineering_guide.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="feature-engineering-guide">
<h1>Feature Engineering Guide<a class="headerlink" href="#feature-engineering-guide" title="Permalink to this headline">¶</a></h1>
<p>Feature engineering is the process of transforming raw variables into
feature values that can be input to a learning algorithm. We consider in this process every step that is needed to go from the raw dataset to the learning algorithm: cleaning missing values and outliers, scaling values, deriving complex features from multiple variables, reducing dimensionality, encoding categorical and ordinal variables, and more.</p>
<p>In Ballet, feature engineering is centered around creating feature definitions.
These are modular, flexible, and expressive and will allow us to compose an
entire feature engineering pipeline out of individual feature objects.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>By the end of this guide, you will</p>
<ol class="arabic simple">
<li><p>understand the concept of a “feature definition”</p></li>
<li><p>be able to write feature definitions in Ballet</p></li>
<li><p>be familiar with the feature engineering primitives provided in the <a class="reference internal" href="api/ballet.eng.html#module-ballet.eng" title="ballet.eng"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ballet.eng</span></code></a> package</p></li>
</ol>
</div>
<div class="section" id="feature-engineering-in-90-seconds">
<h2>Feature engineering in 90 seconds<a class="headerlink" href="#feature-engineering-in-90-seconds" title="Permalink to this headline">¶</a></h2>
<p>A <em>feature definition</em>, or simply “feature,” is a tuple <code class="docutils literal notranslate"><span class="pre">(input_columns,</span> <span class="pre">transformer_to_apply)</span></code>.  Your job in feature engineering is to define this tuple of input columns and a transformer to apply on them.</p>
<p>A feature “requests” an input column or a set of input columns. Then it defines a transformation to apply to this input. This <em>transformer</em> may be one step or a list of steps. Each step provides a <em>fit</em> method and a <em>transform</em> method, though Ballet supports more concise syntax for the most common transformations. When features are part of a <em>feature engineering pipeline</em>, their outputs are concatenated together to form a <em>feature matrix</em>.</p>
<p>Let’s take a look at the simplest possible feature:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ballet</span> <span class="kn">import</span> <span class="n">Feature</span>
<span class="nb">input</span> <span class="o">=</span> <span class="s2">&quot;Lot Area&quot;</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">transformer</span><span class="p">)</span>
</pre></div>
</div>
<p>We have to create an instance of <a class="reference internal" href="api/ballet.feature.html#ballet.feature.Feature" title="ballet.feature.Feature"><code class="xref py py-class docutils literal notranslate"><span class="pre">Feature</span></code></a>. The special value <code class="docutils literal notranslate"><span class="pre">None</span></code> will be replaced by Ballet with an object that applies that identity transformation. This feature, when applied to a dataset that contains the column <code class="docutils literal notranslate"><span class="pre">Lot</span> <span class="pre">Area</span></code>, will pass that column through unchanged. It’s not super exciting.</p>
<p>Let’s look at a more realistic feature:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ballet</span> <span class="kn">import</span> <span class="n">Feature</span>
<span class="kn">from</span> <span class="nn">ballet.eng.external</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Lot Area&quot;</span><span class="p">,</span> <span class="s2">&quot;Garage Area&quot;</span><span class="p">,</span> <span class="s2">&quot;1st Flr SF&quot;</span><span class="p">]</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="p">[</span>
    <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Lot Area&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Garage Area&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;1st Flr SF&quot;</span><span class="p">],</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Yard Area&quot;</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">transformer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>This feature requests three input columns and then defines two transformer steps. The first step subtracts the area of a house’s garage and first floor from its lot. The second step fills in missing values with the median of the training dataset. When applied to a dataset that contains the three columns, this feature will compute some measure of “yard area” for a house.</p>
<p>You have enough to get started! But read on to learn all about the powerful functionality that Ballet provides for developing feature definitions.</p>
</div>
<div class="section" id="writing-features">
<h2>Writing features<a class="headerlink" href="#writing-features" title="Permalink to this headline">¶</a></h2>
<div class="section" id="feature-definitions">
<h3>Feature definitions<a class="headerlink" href="#feature-definitions" title="Permalink to this headline">¶</a></h3>
<p>A feature definition, or simply “feature,” is the code to extract feature values from raw data, paired with meta-information about the transformation.</p>
<p>In Ballet, features are realized in Python as instances of <a class="reference internal" href="api/ballet.feature.html#ballet.feature.Feature" title="ballet.feature.Feature"><code class="xref py py-class docutils literal notranslate"><span class="pre">Feature</span></code></a> with the following attributes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">input</span></code>: the input columns to the feature from the raw dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">transformer</span></code>: the transformation applied to the selected columns. The transformer is an object (or sequence of objects) that provide (or each provide) <code class="docutils literal notranslate"><span class="pre">fit</span></code> and <code class="docutils literal notranslate"><span class="pre">transform</span></code> methods.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of the feature.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">description</span></code>: a longer, human-readable description of the feature.</p></li>
</ul>
<p>A feature can either be scalar-valued (produce a scalar feature value for each data instance) or it can be vector-valued (produce a vector of feature values for each data instance, as in the embedding of a categorical variable). It learns parameters from a training dataset which it can then use to extract feature values from previously unseen data instances, avoiding any “leakage” of information through feature engineering.</p>
</div>
<div class="section" id="input-types">
<h3>Input types<a class="headerlink" href="#input-types" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">input</span></code> field accepts either a key or a collection of keys (usually strings) identifying columns from the raw data.</p>
<ul class="simple">
<li><p>if <code class="docutils literal notranslate"><span class="pre">input</span></code> is a scalar key, a 1-dimensional pandas Series or numpy array is passed to the transformer</p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">input</span></code> is a collection of keys, a 2-dimensional pandas DataFrame or numpy array is passed to the transformer</p></li>
</ul>
<p>There is also experimental support for some other ways of indexing data frames, such as <a class="reference external" href="https://pandas.pydata.org/docs/user_guide/indexing.html#selection-by-callable">selection by callable</a>. Here, <code class="docutils literal notranslate"><span class="pre">input</span></code> must be a function that accepts one argument that returns valid output for indexing, such as <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">df:</span> <span class="pre">['A',</span> <span class="pre">'B']</span></code>. This is not officially supported by the underlying sklearn-pandas library, so please report any issues you experience.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.19.</span></p>
</div>
</div>
<div class="section" id="transformers">
<h3>Transformers<a class="headerlink" href="#transformers" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">transformer</span></code> field accepts one or more transformer steps.</p>
<p>A <em>transformer step</em> is a <em>transformer-like object</em> that satisfies the scikit-learn <a class="reference external" href="https://scikit-learn.org/stable/glossary.html#term-transformer">Transformer API</a>, having <code class="docutils literal notranslate"><span class="pre">fit</span></code>, <code class="docutils literal notranslate"><span class="pre">transform</span></code>, and <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code> methods.</p>
<p>In addition, Ballet supports a more concise syntax for expressing common operations. When a feature is created, it replaces this shorthand with explicit transformers. The following syntax is supported:</p>
<ul class="simple">
<li><p>a callable that accepts the <code class="docutils literal notranslate"><span class="pre">X</span></code> DataFrame as input and produces an array-like as output. This can be thought of as a transformer that does not have a fit stage. Ballet will convert it into a <code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionTransformer</span></code> object.</p></li>
<li><p>the value <code class="docutils literal notranslate"><span class="pre">None</span></code>, shorthand to indicate the identity transformer. Ballet will convert it into an <a class="reference internal" href="api/ballet.eng.html#ballet.eng.IdentityTransformer" title="ballet.eng.IdentityTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">IdentityTransformer</span></code></a> object.</p></li>
<li><p>a tuple of <code class="docutils literal notranslate"><span class="pre">(input,</span> <span class="pre">transformer)</span></code> to indicate a nested transformation. This transformer then operates on only a subset of the inputs that your feature is already working on. Both elements of the tuple are interpreted the same as if they were passed to the <a class="reference internal" href="api/ballet.feature.html#ballet.feature.Feature" title="ballet.feature.Feature"><code class="xref py py-class docutils literal notranslate"><span class="pre">Feature</span></code></a> constructor. Internally, they will be converted to a <a class="reference internal" href="api/ballet.eng.base.html#ballet.eng.base.SubsetTransformer" title="ballet.eng.base.SubsetTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">SubsetTransformer</span></code></a>, which you can also use directly.</p></li>
<li><p>another feature instance itself! This is another way to nest transformations. You can import a feature from another module and use it within your own transformer.</p></li>
</ul>
</div>
<div class="section" id="automatic-data-conversions">
<h3>Automatic data conversions<a class="headerlink" href="#automatic-data-conversions" title="Permalink to this headline">¶</a></h3>
<p>Ballet wraps each transformer step with additional code in order to make it more robust to different data types. It does this by trying to pass the most “obvious” data types to the transformer. If the transformation fails in a predictable way (i.e. the transformer appears to not be able to handle that data type), then Ballet tries again with the next most obvious input data type.</p>
<p>If the input is a scalar key, Ballet tries to pass, in order:</p>
<ol class="arabic simple">
<li><p>a <code class="docutils literal notranslate"><span class="pre">Series</span></code></p></li>
<li><p>a 1-d numpy array (vector)</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> with one column</p></li>
<li><p>a 2-d numpy array</p></li>
</ol>
<p>If the input is a collection of keys, Ballet tries to pass, in order:</p>
<ol class="arabic simple">
<li><p>a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code></p></li>
<li><p>a 2-d numpy array</p></li>
</ol>
<p>Usually this process will help you behind the scenes by catching and resolving errors due to incorrect data types. However, if the transformer fails on <em>all</em> data types, then Ballet gives up. Each error message from each data conversion attempt will be shown together. For debugging, you should start by looking at the top most error message. You can also enable the Ballet logger at the debug level (<code class="docutils literal notranslate"><span class="pre">ballet.util.log.enable('ballet',</span> <span class="pre">level='DEBUG')</span></code>) to see the details of the conversion attempts. You may see <a class="reference internal" href="api/ballet.transformer.html#ballet.transformer.DelegatingRobustTransformer" title="ballet.transformer.DelegatingRobustTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">DelegatingRobustTransformer</span></code></a> in the stacktrace, which does the wrapping. We are working on improving the debugging experience in this situation.</p>
</div>
<div class="section" id="feature-engineering-pipelines">
<h3>Feature engineering pipelines<a class="headerlink" href="#feature-engineering-pipelines" title="Permalink to this headline">¶</a></h3>
<p>A feature engineering pipeline can be created out of zero or more features. It has a fit/transform API. When applied to raw data, it applies each underlying feature in parallel and concatenates the results.</p>
</div>
<div class="section" id="okay-but-why">
<h3>Okay, but why?<a class="headerlink" href="#okay-but-why" title="Permalink to this headline">¶</a></h3>
<p>In the data science community, it is common to do feature engineering by applying a sequence of
mutations to a data frame object or using <code class="docutils literal notranslate"><span class="pre">sklearn.preprocessing</span></code> objects. Why do we go through
hoops to use <a class="reference internal" href="api/ballet.feature.html#ballet.feature.Feature" title="ballet.feature.Feature"><code class="xref py py-class docutils literal notranslate"><span class="pre">Feature</span></code></a> objects?</p>
<ol class="arabic simple">
<li><p><em>Modularity.</em> Each feature stands alone and can be reasoned about,
validated, and implemented separately.</p></li>
<li><p><em>Leakage.</em> By writing all features as learned transformations (with
separate fit and transform stages) and enforcing a train-test split, we
ensure that feature engineering code never sees test data before it applies
transformations on new instances, helping better estimate generalization performance.</p></li>
<li><p><em>Clearly declare inputs and outputs.</em> Each feature declares its own inputs
(and optionally outputs) and can operate on them only. Thus a feature can
impute missing values in a single column, as opposed to the entire dataset,
and different <code class="docutils literal notranslate"><span class="pre">Feature</span></code> objects can target different subsets of the input
variable space.</p></li>
<li><p><em>Pipelines.</em> Feature objects can be easily composed together can be
combined into a pipeline that can learn feature transformations from
training data and apply them on new instances.</p></li>
<li><p><em>Robustness.</em> Data scientists are often surprised to find the number of
errors that arise from trying to use multiple libraries together, such as
pandas and scikit-learn. Common errors include scikit-learn transformers and
estimators failing on columnar data that has the wrong number of dimensions
(i.e. 1-dimensional or 2-dimensional column vectors). Features in Ballet
magically transform feature input data appropriately to avoid common errors.</p></li>
</ol>
</div>
</div>
<div class="section" id="learn-by-example">
<h2>Learn by example<a class="headerlink" href="#learn-by-example" title="Permalink to this headline">¶</a></h2>
<p>Let’s dive into some examples.</p>
<div class="section" id="a-simple-feature">
<h3>A simple feature<a class="headerlink" href="#a-simple-feature" title="Permalink to this headline">¶</a></h3>
<p>Here is a simple feature, for the <a class="reference external" href="https://github.com/HDI-Project/ballet-predict-house-prices">HDI-Project/ballet-predict-house-prices</a> problem. Imagine we are working with
the following simplified dataset:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">X_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span>
    <span class="s1">&#39;{&quot;Neighborhood&quot;:{&quot;0&quot;:&quot;NAmes&quot;,&quot;1&quot;:&quot;NAmes&quot;,&quot;2&quot;:&quot;NAmes&quot;,&quot;3&quot;:&quot;NAmes&quot;,&quot;4&quot;:&quot;Gilbert&quot;},&quot;Lot Frontage&quot;:{&quot;0&quot;:141.0,&quot;1&quot;:80.0,&quot;2&quot;:null,&quot;3&quot;:93.0,&quot;4&quot;:74.0},&quot;Lot Area&quot;:{&quot;0&quot;:31770,&quot;1&quot;:11622,&quot;2&quot;:14267,&quot;3&quot;:11160,&quot;4&quot;:13830},&quot;Exterior 1st&quot;:{&quot;0&quot;:null,&quot;1&quot;:&quot;VinylSd&quot;,&quot;2&quot;:&quot;Wd Sdng&quot;,&quot;3&quot;:&quot;BrkFace&quot;,&quot;4&quot;:&quot;VinylSd&quot;},&quot;Garage Area&quot;:{&quot;0&quot;:528.0,&quot;1&quot;:730.0,&quot;2&quot;:312.0,&quot;3&quot;:522.0,&quot;4&quot;:null},&quot;1st Flr SF&quot;:{&quot;0&quot;:1656,&quot;1&quot;:896,&quot;2&quot;:1329,&quot;3&quot;:2110,&quot;4&quot;:928}}&#39;</span>
<span class="p">)</span>
<span class="n">y_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span>
    <span class="s1">&#39;{&quot;0&quot;:215000,&quot;1&quot;:105000,&quot;2&quot;:172000,&quot;3&quot;:244000,&quot;4&quot;:189900}&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s2">&quot;series&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>So <code class="docutils literal notranslate"><span class="pre">X_df</span></code> looks as follows (the blank cells are <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values):</p>
<table class="docutils align-default" id="writing-features-x-df">
<caption><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">X_df</span></code></span><a class="headerlink" href="#writing-features-x-df" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Neighborhood</p></th>
<th class="head"><p>Lot Frontage</p></th>
<th class="head"><p>Lot Area</p></th>
<th class="head"><p>Exterior 1st</p></th>
<th class="head"><p>Garage Area</p></th>
<th class="head"><p>1st Flr SF</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>NAmes</p></td>
<td><p>141.0</p></td>
<td><p>31770</p></td>
<td></td>
<td><p>528.0</p></td>
<td><p>1656</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>NAmes</p></td>
<td><p>80.0</p></td>
<td><p>11622</p></td>
<td><p>VinylSd</p></td>
<td><p>730.0</p></td>
<td><p>896</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>NAmes</p></td>
<td></td>
<td><p>14267</p></td>
<td><p>Wd Sdng</p></td>
<td><p>312.0</p></td>
<td><p>1329</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>NAmes</p></td>
<td><p>93.0</p></td>
<td><p>11160</p></td>
<td><p>BrkFace</p></td>
<td><p>522.0</p></td>
<td><p>2110</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>Gilbert</p></td>
<td><p>74.0</p></td>
<td><p>13830</p></td>
<td><p>VinylSd</p></td>
<td></td>
<td><p>928</p></td>
</tr>
</tbody>
</table>
<p>We define our first feature:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ballet</span> <span class="kn">import</span> <span class="n">Feature</span>

<span class="nb">input</span> <span class="o">=</span> <span class="s2">&quot;Lot Area&quot;</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">transformer</span><span class="p">)</span>
</pre></div>
</div>
<p>This feature requests one input, the <code class="docutils literal notranslate"><span class="pre">Lot</span> <span class="pre">Area</span></code> column of the raw dataset.  It’s transformer is given as <code class="docutils literal notranslate"><span class="pre">None</span></code>, syntactic sugar indicating the identity transformation. When the feature is executed as part of a pipeline, the transformer’s fit and transform methods will be called receiving the one column as input. Here we access the <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> property, which is a convenience to show a feature engineering pipeline containing just the one feature.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">pipeline</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_df</span><span class="p">)</span>
<span class="c1"># array([[31770],</span>
<span class="c1">#        [11622],</span>
<span class="c1">#        [14267],</span>
<span class="c1">#        [11160],</span>
<span class="c1">#        [13830]])</span>
</pre></div>
</div>
<p>The behavior is similar to the following “imperative” code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">X_df</span><span class="p">[</span><span class="nb">input</span><span class="p">]</span>
<span class="n">transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="learned-transformations">
<h3>Learned transformations<a class="headerlink" href="#learned-transformations" title="Permalink to this headline">¶</a></h3>
<p>Let’s take a look at another example.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ballet</span> <span class="kn">import</span> <span class="n">Feature</span>
<span class="kn">from</span> <span class="nn">ballet.eng.external</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="nb">input</span> <span class="o">=</span> <span class="s2">&quot;Lot Frontage&quot;</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Imputed Lot Frontage&quot;</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">transformer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>The feature requests one input, the <code class="docutils literal notranslate"><span class="pre">Lot</span> <span class="pre">Frontage</span></code> column. Its transformer is a <a class="reference internal" href="api/ballet.eng.external.html#ballet.eng.external.SimpleImputer" title="ballet.eng.external.SimpleImputer"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleImputer</span></code></a> instance. It will receive as its input a data frame with this one column. So we get the following behavior when the feature is executed as part of a pipeline:</p>
<ul class="simple">
<li><p>during training (fit-stage), the transformer will compute the mean of the <code class="docutils literal notranslate"><span class="pre">Lot</span> <span class="pre">Frontage</span></code> values that are not missing</p></li>
<li><p>during training (transform-stage), the transformer will replace missing values with the computed training mean</p></li>
<li><p>during testing (transform-stage), the transformer will replace missing values with the computed training mean</p></li>
</ul>
<p><a class="reference internal" href="api/ballet.eng.external.html#ballet.eng.external.SimpleImputer" title="ballet.eng.external.SimpleImputer"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleImputer</span></code></a> is re-exported by Ballet from scikit-learn; see the full assortment of primitives that are available <a class="reference external" href="#feature-engineering-primitives">below</a>.</p>
</div>
<div class="section" id="multi-column-inputs-and-transformer-lists">
<h3>Multi-column inputs and transformer lists<a class="headerlink" href="#multi-column-inputs-and-transformer-lists" title="Permalink to this headline">¶</a></h3>
<p>Let’s took a look at another example.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ballet</span> <span class="kn">import</span> <span class="n">Feature</span>
<span class="kn">from</span> <span class="nn">ballet.eng.external</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Lot Area&quot;</span><span class="p">,</span> <span class="s2">&quot;Garage Area&quot;</span><span class="p">,</span> <span class="s2">&quot;1st Flr SF&quot;</span><span class="p">]</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="p">[</span>
    <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Lot Area&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Garage Area&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;1st Flr SF&quot;</span><span class="p">],</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Yard Area&quot;</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">transformer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>The feature requests three inputs, which are various measures of square footage on the property. The combined transformer is a sequence of two transformer steps. The first transformer step is a function that will receive as its input a DataFrame with three columns, and it computes the portion of the lot area that is not attributable to the garage or the house footprint. However, there may be missing values after this operation if any of the columns had missing values, so we impute them with the median of the training dataset. Here, the first function is implicitly converted into a <code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionTransformer</span></code> (other shorthand is also supported for <a class="reference external" href="#transformers">specifying transformer steps</a>).</p>
</div>
<div class="section" id="nested-transformers">
<h3>Nested transformers<a class="headerlink" href="#nested-transformers" title="Permalink to this headline">¶</a></h3>
<p>You can even nest transformers or other features within the <code class="docutils literal notranslate"><span class="pre">transformer</span></code> field. This next feature calculates how “narrow” a certain house’s lot is by measuring the ratio between the frontage of the lot and its depth, and scaling the resulting values to a 0-1 range.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">ballet</span> <span class="kn">import</span> <span class="n">Feature</span>
<span class="kn">from</span> <span class="nn">ballet.eng.external</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">predict_house_prices.features.contrib.user_jane.feature_impute_lot_frontage</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">feature</span> <span class="k">as</span> <span class="n">impute_lot_frontage</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Lot Frontage&quot;</span><span class="p">,</span> <span class="s2">&quot;Lot Area&quot;</span><span class="p">]</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">impute_lot_frontage</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">impute_lot_frontage</span><span class="o">.</span><span class="n">transformer</span><span class="p">),</span>
    <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Lot Area&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Lot Frontage&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
    <span class="k">lambda</span> <span class="n">ser</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
    <span class="k">lambda</span> <span class="n">ser</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ser</span><span class="p">),</span>
    <span class="n">MinMaxScaler</span><span class="p">(),</span>
<span class="p">]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Narrowness of the lot&quot;</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">transformer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>The first transformer step shows how to use nested transformers. You can pass a tuple of <code class="docutils literal notranslate"><span class="pre">(input,</span> <span class="pre">transformer)</span></code>, just like the current feature you are developing! Here, we are re-using the same input and transformer from the <code class="docutils literal notranslate"><span class="pre">impute_lot_frontage</span></code> that we <a class="reference external" href="#example-learned-transformation">already developed</a>. Any columns that are not used in the nested transformer will be passed through to the next transformer step unchanged. The next transformer step computes the ratio of depth (area/frontage) to frontage; a value of 1.0 is a square lot, a larger value is a more narrow lot. Since a smaller value is a less narrow lot, for the purpose of this feature we clip these smaller values to 1. There are a lot of squarish lots, so we also take the log of this ratio to address skew. Finally, we scale the measure to a 0-1 range.</p>
</div>
<div class="section" id="complex-features">
<h3>Complex features<a class="headerlink" href="#complex-features" title="Permalink to this headline">¶</a></h3>
<p>Here’s another example of a feature that is a bit more complex. The idea here is that we want to encode <code class="docutils literal notranslate"><span class="pre">Exterior</span> <span class="pre">1st</span></code> (exterior covering on house) but first we have to impute missing values. Since houses in a neighborhood may have similar exterior characteristics, we can impute missing values with the most common exterior covering in the neighborhood.</p>
<p>To do this we have to first determine the most common exterior covering per neighborhood in the training dataset, then store that mapping. This is where Ballet’s <a class="reference internal" href="api/ballet.eng.html#ballet.eng.GroupwiseTransformer" title="ballet.eng.GroupwiseTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">GroupwiseTransformer</span></code></a> comes in handy, which clones the transformer many times and fits it separately for each group. Finally we can encode the categories using a <a class="reference internal" href="api/ballet.eng.external.html#ballet.eng.external.OneHotEncoder" title="ballet.eng.external.OneHotEncoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">OneHotEncoder</span></code></a> for example.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ballet</span> <span class="kn">import</span> <span class="n">Feature</span>
<span class="kn">from</span> <span class="nn">ballet.eng</span> <span class="kn">import</span> <span class="n">GroupwiseTransformer</span>
<span class="kn">from</span> <span class="nn">ballet.eng.external</span> <span class="kn">import</span> <span class="n">SimpleImputer</span><span class="p">,</span> <span class="n">OneHotEncoder</span>

<span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Neighborhood&quot;</span><span class="p">,</span> <span class="s2">&quot;Exterior 1st&quot;</span><span class="p">]</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">GroupwiseTransformer</span><span class="p">(</span>
        <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">),</span>
        <span class="n">groupby_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;by&quot;</span><span class="p">:</span> <span class="s2">&quot;Neighborhood&quot;</span><span class="p">},</span>
        <span class="n">column_selection</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Exterior 1st&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="n">OneHotEncoder</span><span class="p">(),</span>
<span class="p">]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Cleaned and encoded exterior covering&quot;</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">transformer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="feature-engineering-primitives">
<h2>Feature engineering primitives<a class="headerlink" href="#feature-engineering-primitives" title="Permalink to this headline">¶</a></h2>
<p>Many features exhibit common patterns, such as scaling or imputing variables using simple procedures. And while some features are relatively simple and have no learning component, others are more involved to express. Commonly, data scientists extract these more advanced features by manipulating training and test tables directly using popular libraries like <em>pandas</em> or <em>dplyr</em> (often leading to leakage), whereas these operations should instead be rewritten in a fit/transform style.</p>
<p>To ease this process, Ballet provides a library of feature engineering primitives, <a class="reference internal" href="api/ballet.eng.html#module-ballet.eng" title="ballet.eng"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ballet.eng</span></code></a>, which implements many common learned transformations and utilities.</p>
<div class="section" id="operating-on-groups">
<h3>Operating on groups<a class="headerlink" href="#operating-on-groups" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.GroupedFunctionTransformer" title="ballet.eng.GroupedFunctionTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.GroupedFunctionTransformer</span></code></a></p></li>
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.GroupwiseTransformer" title="ballet.eng.GroupwiseTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.GroupwiseTransformer</span></code></a></p></li>
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.ColumnSelector" title="ballet.eng.ColumnSelector"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.ColumnSelector</span></code></a></p></li>
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.SubsetTransformer" title="ballet.eng.SubsetTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.SubsetTransformer</span></code></a></p></li>
</ul>
</div>
<div class="section" id="logic-to-avoid-leakage">
<h3>Logic to avoid leakage<a class="headerlink" href="#logic-to-avoid-leakage" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.ConditionalTransformer" title="ballet.eng.ConditionalTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.ConditionalTransformer</span></code></a></p></li>
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.ComputedValueTransformer" title="ballet.eng.ComputedValueTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.ComputedValueTransformer</span></code></a></p></li>
</ul>
</div>
<div class="section" id="data-cleaning">
<h3>Data cleaning<a class="headerlink" href="#data-cleaning" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.LagImputer" title="ballet.eng.LagImputer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.LagImputer</span></code></a></p></li>
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.NullFiller" title="ballet.eng.NullFiller"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.NullFiller</span></code></a></p></li>
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.NullIndicator" title="ballet.eng.NullIndicator"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.NullIndicator</span></code></a></p></li>
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.ValueReplacer" title="ballet.eng.ValueReplacer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.ValueReplacer</span></code></a></p></li>
</ul>
</div>
<div class="section" id="operating-on-time-series-data">
<h3>Operating on time series data<a class="headerlink" href="#operating-on-time-series-data" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.SingleLagger" title="ballet.eng.SingleLagger"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.SingleLagger</span></code></a></p></li>
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.make_multi_lagger" title="ballet.eng.make_multi_lagger"><code class="xref py py-func docutils literal notranslate"><span class="pre">ballet.eng.make_multi_lagger()</span></code></a></p></li>
</ul>
</div>
<div class="section" id="utilities">
<h3>Utilities<a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.NamedFramer" title="ballet.eng.NamedFramer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.NamedFramer</span></code></a></p></li>
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.SimpleFunctionTransformer" title="ballet.eng.SimpleFunctionTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.SimpleFunctionTransformer</span></code></a></p></li>
</ul>
</div>
<div class="section" id="other-primitives">
<h3>Other primitives<a class="headerlink" href="#other-primitives" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="api/ballet.eng.html#ballet.eng.BoxCoxTransformer" title="ballet.eng.BoxCoxTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.BoxCoxTransformer</span></code></a></p></li>
</ul>
</div>
<div class="section" id="external-libraries">
<h3>External libraries<a class="headerlink" href="#external-libraries" title="Permalink to this headline">¶</a></h3>
<p>Many feature engineering primitives are also available in scikit-learn and other libraries. Don’t reinvent the wheel!</p>
<p>Ballet re-exports feature engineering primitives from external libraries. Note that not all primitives may be relevant for all projects, for example many feature engineering primitives from <code class="docutils literal notranslate"><span class="pre">skits</span></code> and <code class="docutils literal notranslate"><span class="pre">tsfresh</span></code> are only appropriate for time-series forecasting problems.</p>
<p>All of these are further re-exported in the catch-all <code class="docutils literal notranslate"><span class="pre">external</span></code> module, which is the best place to import from in your code:</p>
<ul class="simple">
<li><p><a class="reference internal" href="api/ballet.eng.external.html#module-ballet.eng.external" title="ballet.eng.external"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ballet.eng.external</span></code></a>: all external primitives</p></li>
</ul>
<p>You can also browse the list of primitives from each external library:</p>
<ul class="simple">
<li><p><a class="reference internal" href="api/ballet.eng.external.category_encoders.html#module-ballet.eng.external.category_encoders" title="ballet.eng.external.category_encoders"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ballet.eng.external.category_encoders</span></code></a>: primitives from <a class="reference external" href="http://contrib.scikit-learn.org/category_encoders/">category_encoders</a></p></li>
<li><p><a class="reference internal" href="api/ballet.eng.external.feature_engine.html#module-ballet.eng.external.feature_engine" title="ballet.eng.external.feature_engine"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ballet.eng.external.feature_engine</span></code></a>: primitives from <a class="reference external" href="https://feature-engine.readthedocs.io/en/latest/">feature_engine</a></p></li>
<li><p><a class="reference internal" href="api/ballet.eng.external.featuretools.html#module-ballet.eng.external.featuretools" title="ballet.eng.external.featuretools"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ballet.eng.external.featuretools</span></code></a>: primitives from <a class="reference external" href="https://www.featuretools.com/">featuretools</a></p></li>
<li><p><a class="reference internal" href="api/ballet.eng.external.skits.html#module-ballet.eng.external.skits" title="ballet.eng.external.skits"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ballet.eng.external.skits</span></code></a>: primitives from <a class="reference external" href="https://github.com/EthanRosenthal/skits">skits</a></p></li>
<li><p><a class="reference internal" href="api/ballet.eng.external.sklearn.html#module-ballet.eng.external.sklearn" title="ballet.eng.external.sklearn"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ballet.eng.external.sklearn</span></code></a>: primitives from <a class="reference external" href="https://scikit-learn.org/stable/index.html">sklearn</a></p></li>
<li><p><a class="reference internal" href="api/ballet.eng.external.tsfresh.html#module-ballet.eng.external.tsfresh" title="ballet.eng.external.tsfresh"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ballet.eng.external.tsfresh</span></code></a>: primitives from <a class="reference external" href="https://tsfresh.readthedocs.io/en/latest/index.html">tsfresh</a></p></li>
</ul>
</div>
</div>
<div class="section" id="differences-from-pandas">
<h2>Differences from Pandas<a class="headerlink" href="#differences-from-pandas" title="Permalink to this headline">¶</a></h2>
<p>It may be helpful to see a lot of examples of pandas-style code with the associated Ballet feature implementations, especially if you are more familiar with writing “imperative” pandas code.</p>
<p>Recall that we will be working with the simplified table <code class="docutils literal notranslate"><span class="pre">X_df</span></code> <a class="reference external" href="#writing-features-x-df">from above</a>.</p>
<p>The first two examples are pretty simple.</p>
<p>In example 3, we can see where Ballet’s <a class="reference internal" href="api/ballet.feature.html#ballet.feature.Feature" title="ballet.feature.Feature"><code class="xref py py-class docutils literal notranslate"><span class="pre">Feature</span></code></a> can be helpful compared to vanilla pandas for machine learning: we can easily incorporate a transformer from scikit-learn that learns the column mean on the training data and applies it on unseen test data.</p>
<p>In example 4, we see how multiple transformers can be chained together in a list.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Pandas</p></th>
<th class="head"><p>Ballet</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">X_df</span><span class="p">[</span><span class="s2">&quot;Lot Frontage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</td>
<td><div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ballet</span> <span class="kn">import</span> <span class="n">Feature</span>

<span class="nb">input</span> <span class="o">=</span> <span class="s2">&quot;Lot Frontage&quot;</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ser</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">transformer</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">X_df</span><span class="p">[[</span><span class="s2">&quot;Lot Frontage&quot;</span><span class="p">,</span> <span class="s2">&quot;Lot Area&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</td>
<td><div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ballet</span> <span class="kn">import</span> <span class="n">Feature</span>

<span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Lot Frontage&quot;</span><span class="p">,</span> <span class="s2">&quot;Lot Area&quot;</span><span class="p">]</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">transformer</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">X_df</span><span class="p">[</span><span class="s2">&quot;Lot Frontage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">X_df</span><span class="p">[</span><span class="s2">&quot;Lot Frontage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
</pre></div>
</div>
</td>
<td><div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ballet</span> <span class="kn">import</span> <span class="n">Feature</span>
<span class="kn">from</span> <span class="nn">ballet.eng.sklearn</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="nb">input</span> <span class="o">=</span> <span class="s2">&quot;Lot Frontage&quot;</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">transformer</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="p">(</span><span class="n">X_df</span><span class="p">[</span><span class="s2">&quot;Lot Frontage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</td>
<td><div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ballet</span> <span class="kn">import</span> <span class="n">Feature</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nb">input</span> <span class="o">=</span> <span class="s2">&quot;Lot Frontage&quot;</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
    <span class="k">lambda</span> <span class="n">ser</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">transformer</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="rolling-your-own-transformers">
<h2>Rolling your own transformers<a class="headerlink" href="#rolling-your-own-transformers" title="Permalink to this headline">¶</a></h2>
<p>As you come up with more creative features, you may find that you need to create your own transformer classes. Here are some tips for creating your own transformers.</p>
<ol class="arabic">
<li><p>Build off of <a class="reference internal" href="api/ballet.eng.html#ballet.eng.BaseTransformer" title="ballet.eng.BaseTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.BaseTransformer</span></code></a> which inherits from <code class="xref py py-class docutils literal notranslate"><span class="pre">sklearn.base.BaseEstimator</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sklearn.base.TransformerMixin</span></code>, and <a class="reference internal" href="api/ballet.eng.html#ballet.eng.NoFitMixin" title="ballet.eng.NoFitMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.NoFitMixin</span></code></a>.</p></li>
<li><p>(Optional) Implement the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>This method is optional if your transformer does not have any hyperparameters. Following the scikit-learn convention, the init method should take keyword arguments only and do nothing more then set them on <code class="docutils literal notranslate"><span class="pre">self</span></code>. Each keyword argument is a hyperparameter of the transformer. While the signature above uses <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>, you should actually spell out the hyperparameters in the signature (so that they can be listed via introspection).</p>
</li>
<li><p>(Optional) Implement the <code class="docutils literal notranslate"><span class="pre">fit</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>If you do not require a fit method, you can omit this, as a no-op fit method is already provided by the parent class. Any learned parameters should be set on <code class="docutils literal notranslate"><span class="pre">self</span></code>. Following the scikit-learn convention, the names of learned parameters should have trailing underscores. Finally, <code class="docutils literal notranslate"><span class="pre">fit</span></code> should <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">self</span></code> so that it can be chained with other methods on the class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">theta_</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
</li>
<li><p>Implement the <code class="docutils literal notranslate"><span class="pre">transform</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<p>Here you can assume the learned parameters, if any, are available.</p>
</li>
</ol>
<p>You can also read the <a class="reference external" href="https://scikit-learn.org/stable/developers/develop.html#rolling-your-own-estimator">scikit-learn documentation on a similar topic</a>. (Note that this documentation page is likely overkill for the types of transformers you may be implementing.)</p>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Let’s create a feature that captures whether a string variable is the longest value observed in the data. This is a silly feature for a number of reasons, so don’t take it too seriously, but it demonstrates the steps required to roll your own transformer.</p>
<p>Okay, let’s unpack what happened here. First, we declared the input to this feature, <code class="docutils literal notranslate"><span class="pre">'Exterior</span> <span class="pre">1st'</span></code>, a scalar key, so the feature will receive a pandas <code class="docutils literal notranslate"><span class="pre">Series</span></code> as the input <code class="docutils literal notranslate"><span class="pre">X</span></code>. Next we created a new class that inherits from <code class="docutils literal notranslate"><span class="pre">BaseTransformer</span></code>. The transformer does not have any “hyperparameters” so we can skip defining an <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method. We learn the <code class="docutils literal notranslate"><span class="pre">longest_string_length_</span></code> parameter during the fit stage and set it on <code class="docutils literal notranslate"><span class="pre">self</span></code>. We were able to assume that <code class="docutils literal notranslate"><span class="pre">X</span></code> is a series, and thus has the <code class="docutils literal notranslate"><span class="pre">.str</span></code> vectorized string accessor. We can assume this because Ballet will automatically try to pass the input in various formats and will store the format that worked, i.e. “series”. (If this were to be a new feature engineering primitive that would be used in more than this one situation, we might want to add logic to allow the feature to operate on a DataFrame as well.) Next, in the transform stage, we check for each new instance whether the length is greater than or equal to the longest string length observed in the training data. The result will be a 1-d array (series) of <code class="docutils literal notranslate"><span class="pre">bool</span></code>s. Finally, having created the transformer class, we create an instance of it and create our <code class="docutils literal notranslate"><span class="pre">Feature</span></code> object.</p>
</div>
</div>
<div class="section" id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="api/ballet.feature.html#ballet.feature.Feature" title="ballet.feature.Feature"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.feature.Feature</span></code></a></p></li>
<li><p><a class="reference internal" href="api/ballet.pipeline.html#ballet.pipeline.FeatureEngineeringPipeline" title="ballet.pipeline.FeatureEngineeringPipeline"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.pipeline.FeatureEngineeringPipeline</span></code></a></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="consumer_guide.html" class="btn btn-neutral float-right" title="Consumer Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="contributor_guide.html" class="btn btn-neutral float-left" title="Contributor Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018, Micah Smith.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>